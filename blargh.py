from hashlib import sha256
import hashlib
import binascii
from base58 import b58encode
from FUK import reverse_bytes
# pk = bytes.fromhex(pubkey)

def double_sha256(hexstr):
    bytes_ext_pubkey = bytes.fromhex(hexstr)
    return sha256(sha256(bytes_ext_pubkey).digest()).hexdigest()

def get_output_address(hashed_pubkey, op_dup):
    if op_dup:
        prefix = '00'
    else:
        prefix = '05'
    ext_pubkey = prefix + hashed_pubkey
    hash = double_sha256(ext_pubkey)
    bin_adr = bytes.fromhex(ext_pubkey + hash[:8])
    return b58encode(bin_adr).decode()

def get_input_address(pubkey, op_dup):
    bytes_pubkey = bytes.fromhex(pubkey)
    h = hashlib.new('ripemd160')
    h.update(sha256(bytes_pubkey).digest())
    return get_output_address(h.hexdigest(), op_dup)


# adr = get_input_address('03486669962008e0713660b6d69117a65fcecd221d06c1e5077b4d9cd477c0cf98', True)
# adr = get_address('0250863ad64a87ae8a2fe83c1af1a8403cb53f53e486d8511dad8a04887e5b2352')
# adr = get_output_address('4f6d76f02a5553617ec71820e9036afdcbf7d93c')
adr = get_output_address('4c8045932c5a4e57316e6e9c465fc1fba32d6ac3', False)
print(adr)

# raw_hex = '00004020d9fa9295f1a8541782e2797d69d7ebd8291313ebe37d03000000000000000000907d60b7746c6904a25500411d97e38cd32da7c4c0a585362955511420e870454b5ae85d3eb2151795da9402fde303010000000001010000000000000000000000000000000000000000000000000000000000000000ffffffff6403f241092cfabe6d6dacb2706a7a9b20e0b9ec0836c29456ea0e0bde9bd7906e483d1e1bc1533c2e6e10000000f09f909f00104d696e65642062792078786c303030310000000000000000000000000000000000000000000000000000000500fe4d000000000000042478ac4a000000001976a914c825a1ecf2a6830c4401620c3a16f1995057c2ab88ac00000000000000002f6a24aa21a9edbe636a711bc15a5ef19858e16615c80744cbd81b336b73b92dc5dfdf877709bb08000000000000000000000000000000002c6a4c2952534b424c4f434b3abe451677d626d14aa8c46474a15a90a85195abcf3851349bf9294620001d6ce50000000000000000266a24b9e11b6de9d447f33447fe11c3ab42d67ba9e89d0bc0c21abaae623f3b3defadbb67b7010120000000000000000000000000000000000000000000000000000000000000000049dafc3b01000000032782aac102cc27ca91c2a6f620909ebf8086e9770bc1d20bcc3c1208497cb8671a0000006b483045022100b302d1f08349881eb934c9e962a5b3f2e54da88e688c25d0ffff45ff9d3ed1150220711d4a2f77cfdd4de8a05ff06ddf45a18d164ada974458339e03b595d7396c41012103d6f036e684e46577921bd19c58b8611f5caa84b7f7e5758927a4029fc92b272dfeffffffccad01f88fb0bf506c84678810589e2094265ea1565570d254b74460dc93be83010000006a4730440220405c640458cd4945586b25f911c2d323740d43eae2f324e4094b194f796893fb02201e667e8f60df7ea2fd48aa7270d3fd78ac29c60c59315598a151aecbad8db96601210389294708b6f048a05add7dc9ce0ae47cde9bc559a4f1dc3913ecc84a6d599a31feffffff1cfef9dc26ffd9fc19f6c198e844613d2813f493173fac9e2aea654b63e1fa46040000006a47304402202af5f9f05fa58bb23231fa7d01880172c5954d109d5f90d6b27e00608b3b00ff02200e06b55edd65c8305c10a204ffa057d2fcbddaa66166b7448da8f3efbcd47de00121035b2c389a7874c370d8c140b4e756dd337f3c6fd72303246819dc43a19faa6af9feffffff02b16d1000000000001976a914b56fc5277769524f72f786c20a412cbf109b1d8188ace0930400000000001976a914735185c58931db31796740fef52b96928e9f82df88acb6410900010000000131b39a7b9314655d6a66fdffe500cb3e00b0906b0de6b01a9ab99071a39c5d0a000000006b483045022100be25fe0156f86905bf949b4534a4b82dbbd32f35a03e2703cdeae9737898ac62022065d481eeae26ad07dd67850c1943d7072c0fd4e8c6afb0425a0320a78af4d390012102d29ed980f4f2b8a4923f81262c984ecf66da2507d79912542ac7dec59ff8fdbdffffffff022b3b4a000000000017a91430897cc6c9d69f6a2c2f1c651d51f22219f1a4f687ed8332010000000017a9140e222193d04e5d5af3fd1b58e63f8ac4b4a3a08a870000000002000000000101abfa9410d2adeaee08e841611afdac99fd297677f82a52ebe5e79fa5a2ee7ac50100000017160014f2832dd8577c4bc156c9608d9678066c9c7a07c3feffffff025ece3e000000000017a91468966453bed97fc7c4a5d63fec5db0fed89b755d87ff9831230000000017a9145e59ca2b2ed97e570bacdaf4bff6386657a39f3b870247304402202be4e82078e7dddca8df4c785728bf0d132fd7c607294ed87e1f06f0cca1cdc102204a7a439554cb597778af5b9d47f8939abe8a9deb197cbe5c14cca0d4dc2e9e44012102376bae87bb965f7c5750d3f49d250c319f6b729c350de55f575ad36f54828495f0410900010000000001013928399372d4c150a54a5b2129971bb7c115b7c5759fbf4ea2db21cd0682cbc201000000171600140e18f4d234ec6773c6e88fb0507ac14c4b8f31f8ffffffff02c42903000000000017a9142152bb318fee891082f2ea64a9e86f0a392a1ba887c29603000000000017a914706d725a28d9028ba13b65e60be86b596f65bff5870247304402202ad19f58787916af062d11272e889bd084ca11f4a9d659bc8edbd563481a06cd02206b9099d78b929eee114fd3e0cbb08f35718b12ea7915d3d20dbd7616c978b4620121037231033a8f91c063ad440dacae5bfd04788a6629bdc12a5d2a77c57a460acc9b00000000020000000001070333752fc8d92391f9696dd6383440fbe360db3b43350e29a0cfe01a33a49eb01b0000006b483045022100862fcf5c6aea298087fffcaa3be93a8ebac479ebae6f4c94263d2e05614dfe910220710fc8c7117cd37d08d1f4452a84c54b4dccb5deec045209be528ccd4d195f4f012102047b04bc873ce0c8e81b80eeb0e6429ad718380285c229ca247229b6b12e611dfeffffff1394b03ec8c8eaeece28735f6614d3ac49cc82d45aa09157423aa1330e67848c020000006b4830450221008ca2e92eccd4b41d2a13e23c7a3b86b4d7f23972fe6e3ee30e3c9768131420fb02202a1e98bfff9e49f6815d1f9c8b76688a0ee1073f005663ed4584455178ccc6440121029a84aba9c8802b56596dab0151768334d500e618265d371b3745aa653f0918c8feffffff35093a0a95fce81d8563eaa09b28b15782f1921ac28435994d3522fd60bf980f1b0000006a47304402206eb43ab4a2296d69ee393c2ee52fc346981a2e5e9f029870ba541622240e9c16022022a63009542af340da90ddf469c95f63baf24ffc5a6ea13a7fbade162496817f012102d8d0e408b82155c4e354ca17110b6ec8fadc53911216ddb8759c6a75e8cea74afeffffff6c0b44a70c16ba00d541130ab3f75c1a8a19db5b3af4932dd1b2e15320dcd1810100000017160014dad095f3590a87cb6bdc08115d2b43bb6541d8c5feffffff7e5c0d07d233efbc832fa2165c64c0af202b65186c4f8fa0388c4a1e28c4b335000000006b483045022100ac3e6868dc32ff50c26a0d08900e35cb9d33b1f4403fe1f7ecd4859e1b04f1b802203a0d03ac92d902320a38fd01ddbbb028131f8f9eead3b394b5a1cb729ff0e2a001210315d119b029c680a71cef488308c943a0d2554bc9ae691850a7d538c354115d75feffffffc4e0cf8216074c5b7ae5059443d6dcf0dd9167da9e16fb5e7f4305eb65cf110b000000006b483045022100842552032ca8dccf44cf688e0bc2e7d64c3815d0ff20534552c3a506031672c802204f70491c13d505b5cdac177a648c031625effbe5551ac7faebfe34b850ab90bc0121029517cfb2666880eea3a6060548d1a7835a79ddd93a184fe46b510dd09e094242feffffffc8a7a80da01b1c1e035a9730ac86a61abfd3e88d1254b0c5269c2aaab1ce86d7210000006b483045022100c14f75bea9297275e960200d8a8d92a3e7d82e0280d5ecbb7a154f52ed3479f502200decccbe120d10308eea0567141b06bb1c613c5fe3b434503b6f3c8c22111ece012103882bd970941ee88fc2ba0484bd4a2b6768ef321ee7bf82f226ddf5cf992c67e9feffffff0200e1f505000000001976a914203f7a2ad1394694b3acb0a35cd54cc6be07c6e488aca0ad0d000000000017a914916d9a93c2a6a421d2ef695839921fcc513176c98700000002473044022074d7fa37c3f8cc9a61402e8c190b24247843e743e578d23b48359da6a998102e022050eb7ccd3750eb5792a8ae5826cfd19ff7364d07c4d599c32a595c59b852aabf012102a0614e9f6e0587b76e1365aa1b42bf3fc359357bbfae8dd49bf430cc4e2a5fe0000000f1410900020000000001029603ae21f64e0361e63d7b9ad53e1122b978c2b0cd18a37d5efab42312edb2190000000017160014ad908e0f55bcc5c64bfe3debde041ba4f520339afeffffffeed9bb1fceff7ec03398c1e96156b7927a3699c5c629e9676d54403e34bf86af010000001716001416328f651ea70fff438599687f54c68a3aaa567afeffffff02e46816000000000017a9145fa40d415fe5376ae6e70ff73fa1c90fb5e745548782240a000000000017a914bd07b6f018f1a07bdc84eff1c5e598233b1fb67687024730440220509102281b4ce6ee688e659bdfc57c2500f394f802d89847bd1e749902a6be1002207679bfafe6f9f8ebda31153d0e0c1475501750423c636b3ec7791c9669d0061b01210265f36eeca263243236bf2c8e6c76f84f65d12d3d78289c66926674029a735fb202473044022021d84a7bb8b38554abbb880a211f7674efa3c1f63b3663b6046813c1f78961110220576f461fef1b164dd472d660fa925a9b3d6759115555601e8ef8a41a8a4c0a5c01210250e9c11dd246bf18d1ffce698de70dfdf00b190236b41da24b5ca757b49414dcf041090001000000021b473d79bcf98cf4f00ec8341bfae0ad23764c5a3b363516c03601375172ed01020000006a473044022039c05531ece9487e7c6be989474287840d1c24baa5cd72078adba26e1fdc16cf02203ea1cf73fb6c95f1e39a44aa6798d6602fcdb762f611e7410040ecd3f7457fde0121024cd05a1f414d4cdf37bdbae012a60b9c51e0e06beccff001adef70583786aca4ffffffff69828535ece16ecd083ea40d4159d088f51cc91e2fb909b91bfdd6e71cc47030000000006a47304402206981713a508951a3d3be0de9f0ee1786f0961d63bf7e204c6cdc46db101b12ec022008a712bcb995fc0a23a2d2514d68ccd078ab9bf2730136e982a26607ea01961f0121030651e1d15ae9a284ffd712885529d3344db3700be756e6c22c56a6c1b57d359dffffffff0222020000000000001976a914b64513c1f1b889a556463243cca9c26ee626b9a088ac0000000000000000166a146f6d6e69000000000000001f00000017d18e1f000000000001000000010dfeffdcf5a412cfdac12c6a5'
# header_hex = str(raw_hex[:80])
#
# version = '00004020'
# prev_block_hash = 'd9fa9295f1a8541782e2797d69d7ebd8291313ebe37d03000000000000000000'
# merkle_root_hash = '907d60b7746c6904a25500411d97e38cd32da7c4c0a585362955511420e87045'
# timestamp = '4b5ae85d'
# difficulty_target = '3eb21517'
# nonce = '95da9402'
#
#
# header_bin = binascii.unhexlify(header_hex)
# hash = sha256(sha256(header_bin).digest()).digest().hex()
# print(hash)
